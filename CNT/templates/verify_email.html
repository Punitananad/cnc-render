{% extends 'simple_base.html' %}

{% block content %}
<style>
  @import url('https://fonts.googleapis.com/css?family=Poppins:400,500,600,700&display=swap');

  .auth-page * {
    box-sizing: border-box;
    font-family: 'Poppins', sans-serif;
  }

  .auth-page {
    min-height: 70vh;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .auth-page .wrapper {
    position: relative;
    max-width: 430px;
    width: 100%;
    background: #fff;
    padding: 34px;
    border-radius: 6px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
  }

  .auth-page .wrapper h2 {
    font-size: 28px;
    font-weight: 600;
    color: #333;
    margin-bottom: 20px;
  }

  .auth-page .input-box {
    height: 52px;
    margin: 18px 0;
  }

  .auth-page .input-box input {
    height: 100%;
    width: 100%;
    outline: none;
    padding: 0 15px;
    border: 1.5px solid #C7BEBE;
    border-bottom-width: 2px;
    border-radius: 6px;
    transition: all 0.3s ease;
    font-size: 15px;
  }

  .auth-page .input-box input:focus,
  .auth-page .input-box input:valid {
    border-color: #4070f4;
  }

  .auth-page .input-box.button {
    margin-top: 24px;
  }

  .auth-page .input-box.button input {
    color: #fff;
    letter-spacing: 0.5px;
    border: none;
    background: #4070f4;
    cursor: pointer;
    font-weight: 600;
    transition: background 0.3s ease, transform 0.05s ease;
  }

  .auth-page .input-box.button input:hover {
    background: #275df2;
  }

  .auth-page .input-box.button input:active {
    transform: translateY(1px);
  }

  .auth-page .text {
    text-align: center;
    margin-top: 16px;
  }

  .auth-page .text h3 {
    color: #333;
    font-weight: 500;
    font-size: 14px;
  }

  .auth-page .text h3 a {
    color: #4070f4;
    text-decoration: none;
    font-weight: 600;
  }

  .auth-page .text h3 a:hover {
    text-decoration: underline;
  }

  .error-text {
    color: #d93025;
    font-size: 12px;
    margin-top: 6px;
  }

  .hidden {
    display: none;
  }

  .resend-link {
    color: #4070f4;
    cursor: pointer;
    text-decoration: none;
    font-weight: 600;
  }

  .resend-link:hover {
    text-decoration: underline;
  }

  .otp-instructions {
    margin-bottom: 20px;
    color: #555;
    font-size: 14px;
  }
</style>

<div class="auth-page">
  <div class="wrapper">
    <h2>Verify Your Email</h2>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form method="POST" action="/verify-email">
      <input type="hidden" name="email" value="{{ email }}">
      
      <div class="otp-instructions">
        We've sent a 6-digit verification code to <strong>{{ email }}</strong>.
        Please enter it below to verify your email address.
      </div>

      <div class="input-box">
        <input type="text" name="otp" placeholder="Enter verification code" required maxlength="6" pattern="\d{6}">
      </div>

      <div class="input-box button">
        <input type="submit" value="Verify Email">
      </div>
    </form>

    <div class="text">
      <h3>
        Didn't receive the code? 
        <a href="#" onclick="resendCode()" class="resend-link">Resend code</a>
      </h3>
    </div>
  </div>
</div>

<script>
  function resendCode() {
    const email = "{{ email }}";
    fetch('/verify-email/resend', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: `email=${encodeURIComponent(email)}`
    })
    .then(response => {
      if (response.redirected) {
        window.location = response.url;
      }
    })
    .catch(error => console.error('Error:', error));
  }

  // Auto-focus the OTP input field
  document.querySelector('input[name="otp"]').focus();
</script>
{% endblock %}